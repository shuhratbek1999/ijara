import{m as B,_ as A,H as R,v as K,r as v,h as z,S as p,A as S,o as d,a as c,b as e,t as m,n as k,F as T,d as N,f as D,K as V,L as O,O as Q,C as F,k as $,z as q,l as X,Q as G}from"./index-BDffYq90.js";const E="http://176.53.163.29:7005/api/v1/admin-app",H=localStorage.getItem("token");async function J({myId:y,otherUserId:g}){return(await B.get(`${E}/message/one/${y}/${g}`,{headers:{Authorization:`Bearer ${H}`}})).data.data}async function P(){const y=localStorage.getItem("userID");return(await B.get(`${E}/message/incoming/${y}`,{headers:{Authorization:`Bearer ${H}`}})).data}const W={class:"chat-container"},Y={class:"chat-header bg-indigo-600 text-white p-4 flex justify-between items-center shadow-md"},Z={class:"flex items-center"},ee={class:"w-10 h-10 rounded-full bg-indigo-400 flex items-center justify-center text-white font-bold mr-3"},te={class:"font-semibold text-lg"},se={class:"flex items-center"},re={class:"text-sm"},ae={class:"message-text"},oe={class:"message-meta flex justify-end items-center mt-1"},ne={class:"text-xs opacity-70 mr-1"},ie={class:"message-input bg-white dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 p-3"},de={class:"flex items-center"},le=["disabled"],ce={__name:"ChatContent",props:{otherUserId:[String,Number]},emits:["chatClose"],setup(y,{emit:g}){const o=y,b=g,f=R();K();const u=v(null),x=v(localStorage.getItem("userID")),n=v([]),h=v(""),C=v(!1),j=()=>{b("chatClose")},U=async()=>{if(h.value.trim())try{await p.sendMessage({receiverId:o.otherUserId,message:h.value,read:!1}),h.value="",a()}catch(s){console.error("Error sending message:",s)}},r=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=()=>{F(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})},w=()=>{},_=()=>{p.onMessagesRead(({receiverId:s})=>{n.value=n.value.map(t=>t.receiverId==s?{...t,read:!0}:t)})},i=()=>{Array.isArray(n.value)&&n.value.filter(t=>t.sender_id==o.otherUserId&&!t.read).length>0&&(p.markAsRead({receiverId:x.value,senderId:o.otherUserId}),n.value=n.value.map(t=>t.sender_id==o.otherUserId&&!t.read?{...t,read:!0}:t))},I=async()=>{try{n.value=await J({myId:x.value,otherUserId:o.otherUserId}),i(),a()}catch(s){console.error("Xatolik xabarlarni olishda:",s)}},M=async()=>{await p.onReceiveMessage(s=>{n.value.push({receiverId:s.receiverId,sender_id:s.sender_id,message:s.message,time:s.time,read:s.read}),s.sender_id==o.otherUserId&&!s.read&&(p.markAsRead({senderId:s.sender_id,receiverId:s.receiverId}),n.value=n.value.map(t=>t.sender_id==o.otherUserId&&!t.read?{...t,read:!0}:t)),a()})};return z(async()=>{o.otherUserId&&await p.joinRoom({myId:x.value,otherUserId:o.otherUserId}),await M(),await _(),await i(),await I()}),S(()=>f.chatMessage,s=>{Object.keys(s).length!=0&&n.value.length==0&&(n.value.push(s),a())},{immediate:!0}),S(()=>o.otherUserId,()=>{I()}),S(n,()=>{i()},{deep:!0}),(s,t)=>(d(),c("div",W,[e("div",Y,[e("div",Z,[e("div",ee,m(y.otherUserId),1),e("div",null,[e("h2",te," Chat with User "+m(y.otherUserId),1),e("div",se,[e("span",{class:k(["w-2 h-2 rounded-full mr-2",C.value?"bg-green-400":"bg-gray-400"])},null,2),e("span",re,m(C.value?"Online":"Offline"),1)])])]),e("button",{class:"text-white hover:text-gray-200",onClick:j},t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))]),e("div",{ref_key:"messagesContainer",ref:u,class:"messages-area flex-1 p-4 overflow-y-auto bg-gray-50 dark:bg-gray-800 transition-colors duration-300"},[(d(!0),c(T,null,N(n.value,(l,L)=>(d(),c("div",{key:L,class:k(["message mb-4 flex",l.sender_id==x.value?"justify-end":"justify-start"])},[e("div",{class:k(["message-bubble max-w-xs lg:max-w-md px-4 py-2 rounded-lg",l.sender_id==x.value?"bg-indigo-500 text-white rounded-br-none":"bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none shadow-sm"])},[e("p",ae,m(l.message),1),e("div",oe,[e("span",ne,m(r(l.time)),1),l.sender_id==x.value&&l.read?(d(),c("span",{key:0,class:k(["text-xs",l.read?"text-green-400":"text-gray-400"])}," ✓✓ ",2)):D("",!0)])],2)],2))),128))],512),e("div",ie,[e("div",de,[e("button",{onClick:w,class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 mr-2 text-gray-500 dark:text-gray-400"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])),V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>h.value=l),onKeyup:Q(U,["enter"]),placeholder:"Type your message...",class:"flex-1 py-2 px-4 rounded-full bg-gray-100 dark:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 border-none"},null,544),[[O,h.value]]),e("button",{onClick:U,disabled:!h.value.trim(),class:k(["ml-2 p-2 rounded-full text-white",h.value.trim()?"bg-indigo-500 hover:bg-indigo-600":"bg-gray-400 cursor-not-allowed"])},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)]),10,le)])])]))}},ge=A(ce,[["__scopeId","data-v-287e219c"]]),ue={class:"chat-layout flex h-screen bg-gray-50 dark:bg-gray-900"},he={class:"users-sidebar w-full sm:w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-y-auto"},ve={class:"p-4 border-b border-gray-200 dark:border-gray-700"},me={class:"relative mt-3"},ye={key:0,class:"divide-y divide-gray-200 dark:divide-gray-700 my-2"},fe=["onClick"],xe={class:"relative"},be={class:"w-10 h-10 rounded-full bg-indigo-100 dark:bg-gray-600 flex items-center justify-center text-indigo-600 dark:text-indigo-300 font-semibold"},we={key:0,class:"absolute bottom-0 right-0 w-3 h-3 rounded-full bg-green-500 border-2 border-white dark:border-gray-800"},_e={class:"ml-3 flex-1 overflow-hidden"},pe={class:"flex justify-between items-center"},ke={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Ie={class:"text-xs text-gray-500 dark:text-gray-400"},Ce={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},Ue={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},Me={class:"chat-content flex-1 flex flex-col"},$e={key:0,class:"flex-1 overflow-hidden"},Se={key:1,class:"flex-1 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400"},je={__name:"ChatView",setup(y){const g=R(),o=v([]),b=v(null);let f=v(""),u=v(!1);const x=r=>{b.value=r,g.otherUserId=r.sender_id,u.value=!0},n=()=>{b.value={},u.value=!1},h=async()=>{try{o.value=await P(),o.value=o.value.map(r=>({...r,online:Math.random()>.3,last_message:r.last_message||"No messages yet",last_message_time:r.last_message_time||new Date})),u.value=!u.value}catch(r){console.error("Error fetching users:",r)}},C=()=>{if(f.value.length!=0){const r=o.value.filter(a=>{var w,_;return(_=(w=a.sender)==null?void 0:w.name)==null?void 0:_.toLowerCase().includes(f.value.toLowerCase())});o.value=r}else console.log("Qidiruv bo‘sh"),h()},j=r=>r?new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",U=(r,a)=>{console.log(r,a)};return z(()=>{h()}),S(()=>g.messageCount,r=>{U(g.chatMessage,r)}),(r,a)=>{var w,_;return d(),c("div",ue,[e("div",he,[e("div",ve,[a[2]||(a[2]=e("h2",{class:"text-xl font-semibold text-gray-800 dark:text-white"}," Chatlar ",-1)),e("div",me,[V(e("input",{type:"text",placeholder:"Qidirish...","onUpdate:modelValue":a[0]||(a[0]=i=>q(f)?f.value=i:f=i),onInput:C,class:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"},null,544),[[O,$(f)]]),a[1]||(a[1]=e("svg",{class:"absolute right-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),o.value.length>0?(d(),c("div",ye,[(d(!0),c(T,null,N(o.value,i=>{var I,M,s,t,l;return d(),c("div",{key:i.id,onClick:L=>x(i),class:k(["user-item px-4 py-3 flex items-center hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors duration-200",{"bg-indigo-50 dark:bg-gray-700 border-r-4 border-indigo-500":((I=b.value)==null?void 0:I.id)===i.id}])},[e("div",xe,[e("div",be,m(((t=(s=(M=i.sender)==null?void 0:M.name)==null?void 0:s.charAt(0))==null?void 0:t.toUpperCase())||"U"),1),i.online?(d(),c("span",we)):D("",!0)]),e("div",_e,[e("div",pe,[e("h3",ke,m(((l=i.sender)==null?void 0:l.name)||"Nomaʼlum"),1),e("span",Ie,m(j(i.last_message_time)),1)]),e("p",Ce,m(i.last_message||"No messages yet"),1)])],10,fe)}),128))])):(d(),c("div",Ue,a[3]||(a[3]=[e("p",null,"Hozircha xabarlar yo'q",-1)])))]),e("div",Me,[$(u)?(d(),c("div",$e,[(d(),X(ge,{otherUserId:((w=b.value)==null?void 0:w.sender_id)||$(g).otherUserId,key:((_=b.value)==null?void 0:_.sender_id)||$(g).otherUserId,onChatClose:n},null,8,["otherUserId"]))])):(d(),c("div",Se,a[4]||(a[4]=[G('<div class="w-24 h-24 mb-4 text-indigo-200 dark:text-gray-600" data-v-751b825c><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-751b825c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-751b825c></path></svg></div><h3 class="text-xl font-medium mb-2" data-v-751b825c>Chatni boshlang</h3><p class="text-center max-w-md px-4" data-v-751b825c> Chapdagi ro&#39;yxatdan foydalanuvchini tanlang <br data-v-751b825c>yoki yangi suhbat boshlang </p>',3)])))])])}}},Be=A(je,[["__scopeId","data-v-751b825c"]]);export{Be as default};
