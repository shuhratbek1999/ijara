import{f as C,a as n,c as i,n as a,_ as $,C as M,m as N,r as v,o as S,S as p,x,F as R,q as A,A as B,t as y,e as O,b as U,H as T,J as H,K,z as L,u as b,d as X}from"./index-CbKF4FOc.js";const j="http://176.53.163.29:7005/api/v1/admin-app",z=localStorage.getItem("token");async function q({myId:d,otherUserId:t}){return(await C.get(`${j}/message/one/${d}/${t}`,{headers:{Authorization:`Bearer ${z}`}})).data.data}async function E(){const d=localStorage.getItem("userID");return(await C.get(`${j}/message/incoming/${d}`,{headers:{Authorization:`Bearer ${z}`}})).data}const J={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},G={__name:"SendIcon",setup(d){return(t,o)=>(n(),i("svg",J,o[0]||(o[0]=[a("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),a("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])))}},P={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Q={__name:"FileIcon",setup(d){return(t,o)=>(n(),i("svg",P,o[0]||(o[0]=[a("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},null,-1),a("polyline",{points:"13 2 13 9 20 9"},null,-1)])))}},W=$(Q,[["__scopeId","data-v-e641e9aa"]]),Y={class:"chat-room w-full"},Z={class:"chat-header"},ee={key:0,class:"online-status online"},se={key:1,class:"online-status offline"},te={class:"message-content flex"},re={key:0,title:"O‘qilgan",style:{color:"green"},class:"text-xs mt-6"},ae={class:"mt-6 inline-block text-xs"},ne={class:"p-2 border-t-0.1 bg-white flex justify-between"},oe=["disabled"],ie={__name:"ChatContent",props:{otherUserId:[String,Number]},setup(d){const t=d,o=M();N();const l=v(null),c=v(localStorage.getItem("userID")),r=v([]),u=v(""),g=v(!1),h=async()=>{if(u.value.trim())try{await p.sendMessage({receiverId:t.otherUserId,message:u.value,read:!1}),u.value="",m()}catch(e){console.error("Xabar yuborishda xato:",e)}},f=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),m=()=>{L(()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)})},I=()=>{},V=()=>{p.onMessagesRead(({receiverId:e})=>{r.value=r.value.map(s=>s.receiverId==e?(o.messageCount-=1,{...s,read:!0}):s)})},w=()=>{Array.isArray(r.value)&&r.value.filter(s=>s.sender_id==t.otherUserId&&!s.read).length>0&&(p.markAsRead({receiverId:c.value,senderId:t.otherUserId}),r.value=r.value.map(s=>s.sender_id==t.otherUserId&&!s.read?{...s,read:!0}:s))},k=async()=>{try{r.value=await q({myId:c.value,otherUserId:t.otherUserId}),w(),m()}catch(e){console.error("Xatolik xabarlarni olishda:",e)}},D=async()=>{await p.onReceiveMessage(e=>{r.value.push({receiverId:e.receiverId,sender_id:e.sender_id,message:e.message,time:e.time,read:e.read}),e.sender_id==t.otherUserId&&!e.read&&(p.markAsRead({senderId:e.sender_id,receiverId:e.receiverId}),r.value=r.value.map(s=>s.sender_id==t.otherUserId&&!s.read?{...s,read:!0}:s),m())})};return S(async()=>{t.otherUserId&&await p.joinRoom({myId:c.value,otherUserId:t.otherUserId}),await D(),await V(),await w(),await k()}),x(()=>o.chatMessage,e=>{Object.keys(e).length!=0&&r.value.length==0&&r.value.push(e)},{immediate:!0}),x(()=>t.otherUserId,()=>{k()}),x(r,()=>{w()},{deep:!0}),(e,s)=>(n(),i("div",Y,[a("div",Z,[s[1]||(s[1]=a("h2",null,"Chat Room",-1)),g.value?(n(),i("span",ee,"Online")):(n(),i("span",se,"Offline"))]),a("div",{class:"messages overflow-y-scroll h-[600px] bg-gray-300 p-4",ref_key:"messagesContainer",ref:l},[(n(!0),i(R,null,A(r.value,(_,F)=>(n(),i("div",{key:F,class:B(["message",_.sender_id==c.value?"sent":"received"])},[a("div",te,[a("p",null,y(_.message),1),_.sender_id==c.value&&_.read?(n(),i("span",re," ✔️✔️ ")):O("",!0),a("span",ae,y(f(_.time)),1)])],2))),128))],512),a("div",ne,[a("button",{onClick:I},[U(W)]),T(a("input",{"onUpdate:modelValue":s[0]||(s[0]=_=>u.value=_),onKeyup:K(h,["enter"]),placeholder:"Xabar yozing...",class:"py-[10px] px-4 rounded-[20px] outline-0 w-2/3"},null,544),[[H,u.value]]),a("button",{onClick:h,disabled:!u.value.trim(),class:"bg-[#4a76a8] text-white ml-2 py-[10px] px-[15px] rounded-[20px] disabled:bg-[#cccccc] cursor-not-allowed"},[U(G)],8,oe)])]))}},le=$(ie,[["__scopeId","data-v-3ea95257"]]),de={class:"flex max-sm:flex-col sm:flex-col md:flex-row lg:flex-row max-sm:items-center md:items-start h-screen"},ce={class:"border-r p-4 max-sm:w-11/12 md:w-3/12"},ue=["onClick"],he={class:"col-span-2 md:w-9/12 max-sm:w-11/12"},_e={key:1,class:"flex items-center justify-center h-full text-gray-500"},me={__name:"ChatView",setup(d){const t=M(),o=v([]),l=v(null),c=r=>{l.value=r,t.otherUserId=r.sender_id};return S(async()=>{o.value=await E()}),(r,u)=>{var g;return n(),i("div",de,[a("div",ce,[(n(!0),i(R,null,A(o.value,h=>{var f,m;return n(),i("div",{key:h.id,onClick:I=>c(h),class:B(["p-2 hover:bg-gray-100 cursor-pointer rounded",{"bg-blue-100":((f=l.value)==null?void 0:f.id)===h.id}])},y((m=h.sender)==null?void 0:m.name),11,ue)}),128))]),a("div",he,[l.value||b(t).otherUserId?(n(),X(le,{key:0,otherUserId:((g=l.value)==null?void 0:g.sender_id)||b(t).otherUserId},null,8,["otherUserId"])):(n(),i("div",_e," Foydalanuvchini tanlang "))])])}}};export{me as default};
