import{_ as j,r as o,p as z,o as R,j as n,a as b,c as M,b as s,w as i,u as Y,F as G,q as H,n as F,l as y,E as J,P as Q,D as W,g as r,f as c,d as X,k as Z,t as aa}from"./index-B_p4t0Lo.js";import{M as ea}from"./modal-CVYFkxkt.js";import{P as ta}from"./PlusCircleOutlined-DkJMa-ih.js";const la={class:"list"},sa={class:"fields w-full mt-4"},oa={__name:"list",setup(na){const w=o([]),d=o([]),k=o([]),m=o(!1),p=o(null),u=o(!1),e=z({name:"",sub_cat_id:null,fields:[]}),A=o({title:"Kategoriyani boshqarish",width:"50%"}),S=[{title:"Nomi",dataIndex:"name",key:"name"},{title:"Amallar",key:"action",customRender:({record:a})=>y("div",{class:"flex gap-4"},[y(J,{class:"text-blue-500 cursor-pointer",onClick:()=>P(a.id)}),y(Q,{title:"Rostan ham o'chirmoqchimisiz?",onConfirm:()=>B(a.id)},{default:()=>y(W,{class:"text-red-500 cursor-pointer"})})])}],D=async()=>{try{u.value=!0,await Promise.all([g(),E(),I()])}catch{r.error("Ma'lumotlarni yuklashda xatolik")}finally{u.value=!1}},g=async()=>{const a=await c.get("category/all");w.value=a.data.data},E=async()=>{const a=await c.get("subcategory/all");d.value=a.data.data,d.value.length>0&&!e.sub_cat_id&&(e.sub_cat_id=d.value[0].id)},I=async()=>{const a=await c.get("fields/all");k.value=a.data.data},K=async a=>{try{u.value=!0;const t=await c.get(`category/one/${a}`),{fields:f,..._}=t.data.data;e.name=_.name,e.sub_cat_id=_.sub_cat_id,f[0]!==null&&(e.fields=f.map(h=>h.id)),p.value=a,m.value=!0}catch(t){r.error("Kategoriyani yuklashda xatolik"+t)}finally{u.value=!1}},O=()=>{v(),m.value=!0},P=a=>{K(a)},B=async a=>{try{await c.delete(`category/delete/${a}`),r.success("Kategoriya o'chirildi"),await g()}catch{r.error("O'chirishda xatolik")}},N=()=>{m.value=!1,v()},C=async()=>{try{u.value=!0;const a={name:e.name,sub_cat_id:e.sub_cat_id,fields:e.fields.map(t=>({cat_id:t}))};p.value?(await c.patch(`category/update/${p.value}`,a),r.success("Kategoriya muvaffaqiyatli yangilandi")):(await c.post("category/create",a),r.success("Yangi kategoriya muvaffaqiyatli qo'shildi")),m.value=!1,v(),await g()}catch{r.error("Amalni bajarishda xatolik")}finally{u.value=!1}},L=a=>{e.sub_cat_id=a},T=a=>{e.fields=a},U=(a,t)=>t.label.toLowerCase().includes(a.toLowerCase()),v=()=>{var a;e.name="",e.sub_cat_id=((a=d.value[0])==null?void 0:a.id)||null,e.fields=[],p.value=null};return R(()=>{D()}),(a,t)=>{const f=n("a-table"),_=n("a-float-button"),h=n("a-select-option"),x=n("a-select"),q=n("a-form-item"),V=n("a-input"),$=n("a-form");return b(),M("div",la,[s(f,{columns:S,"data-source":w.value,pagination:{pageSize:50},scroll:{y:300}},null,8,["data-source"]),s(_,{type:"primary",onClick:O},{icon:i(()=>[s(Y(ta))]),_:1}),s(ea,{open:m.value,styles:A.value,onClose:N,onAdd:C},{category:i(()=>[s($,{model:e,name:"category-form",autocomplete:"off",class:"w-full",onFinish:C},{default:i(()=>[s(q,{name:"sub_cat_id",label:"Turkum",rules:[{required:!0,message:"Iltimos, turkumni tanlang!"}],"label-col":{span:24},"wrapper-col":{span:24},class:"w-8/12"},{default:i(()=>[s(x,{value:e.sub_cat_id,"onUpdate:value":t[0]||(t[0]=l=>e.sub_cat_id=l),placeholder:"Turkumni tanlang",onChange:L},{default:i(()=>[(b(!0),M(G,null,H(d.value,l=>(b(),X(h,{key:l.id,value:l.id},{default:i(()=>[Z(aa(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(q,{name:"name",label:"Kategoriya nomi",rules:[{required:!0,message:"Iltimos, nom kiriting!"}],"label-col":{span:24},"wrapper-col":{span:24},class:"w-8/12"},{default:i(()=>[s(V,{value:e.name,"onUpdate:value":t[1]||(t[1]=l=>e.name=l),placeholder:"Masalan, Elektronika"},null,8,["value"])]),_:1}),F("div",sa,[t[3]||(t[3]=F("h2",{class:"text-lg font-semibold mb-2"},"Maydonlar",-1)),s(x,{value:e.fields,"onUpdate:value":t[2]||(t[2]=l=>e.fields=l),"show-search":"","filter-option":U,mode:"multiple",style:{width:"100%"},placeholder:"Maydonlarni tanlang",onChange:T,options:k.value.map(l=>({value:l.id,label:l.field_name}))},null,8,["value","options"])])]),_:1},8,["model"])]),_:1},8,["open","styles"])])}}},ua=j(oa,[["__scopeId","data-v-b6c2a24e"]]);export{ua as default};
