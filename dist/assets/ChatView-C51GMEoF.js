import{m as B,_ as R,H as A,v as K,r as f,h as z,S as _,A as $,o as i,a as u,b as e,t as y,n as w,F as T,d as N,f as D,K as V,L as O,O as Q,C as F,u as q,k as M,z as X,l as G,Q as J}from"./index-Bnz_3vkv.js";const E="http://176.53.163.29:7005/api/v1/admin-app",H=localStorage.getItem("token");async function P({myId:x,otherUserId:h}){const r=await B.get(`${E}/message/one/${x}/${h}`,{headers:{Authorization:`Bearer ${H}`}});return r.data.data?r.data.data:[]}async function W(){const x=localStorage.getItem("userID");return(await B.get(`${E}/message/incoming/${x}`,{headers:{Authorization:`Bearer ${H}`}})).data}const Y={class:"chat-container"},Z={class:"chat-header bg-indigo-600 text-white p-4 flex justify-between items-center shadow-md"},ee={class:"flex items-center"},te={class:"w-10 h-10 rounded-full bg-indigo-400 flex items-center justify-center text-white font-bold mr-3"},se={class:"font-semibold text-lg"},re={class:"flex items-center"},ae={class:"text-sm"},oe={class:"message-text"},ne={class:"message-meta flex justify-end items-center mt-1"},de={class:"text-xs opacity-70 mr-1"},ie={class:"message-input bg-white dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 p-3"},le={class:"flex items-center"},ce=["disabled"],ue={__name:"ChatContent",props:{otherUserId:[String,Number]},emits:["chatClose"],setup(x,{emit:h}){const r=x,b=h,S=A();K();const g=f(null),l=f(localStorage.getItem("userID")),n=f([]),v=f(""),k=f(!1),j=()=>{b("chatClose")},I=async()=>{if(v.value.trim())try{await _.sendMessage({receiverId:r.otherUserId,message:v.value,read:!1}),v.value="",o()}catch(s){console.error("Error sending message:",s)}},L=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),o=()=>{F(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})},a=()=>{},p=()=>{_.onMessagesRead(({receiverId:s})=>{n.value=n.value.map(t=>t.receiverId==s?{...t,read:!0}:t)})},m=()=>{Array.isArray(n.value)&&n.value.filter(t=>t.sender_id==r.otherUserId&&!t.read).length>0&&(_.markAsRead({receiverId:l.value,senderId:r.otherUserId}),n.value=n.value.map(t=>t.sender_id==r.otherUserId&&!t.read?{...t,read:!0}:t))},d=async()=>{try{n.value=await P({myId:l.value,otherUserId:r.otherUserId}),console.log(n.value),m(),o()}catch(s){console.error("Xatolik xabarlarni olishda:",s)}},C=async()=>{await _.onReceiveMessage(s=>{s&&typeof s=="object"&&n.value&&n.value.push({receiverId:s.receiverId,sender_id:s.sender_id,message:s.message,time:s.time,read:s.read}),s.sender_id==r.otherUserId&&!s.read&&(_.markAsRead({senderId:s.sender_id,receiverId:s.receiverId}),n.value=n.value.map(t=>t.sender_id==r.otherUserId&&!t.read?{...t,read:!0}:t)),o()})};return z(async()=>{r.otherUserId&&await _.joinRoom({myId:l.value,otherUserId:r.otherUserId}),await C(),await p(),await m(),await d()}),$(()=>S.chatMessage,s=>{Object.keys(s).length!=0&&n.value.length==0&&(n.value.push(s),o())},{immediate:!0}),$(()=>r.otherUserId,()=>{d()}),$(n,()=>{m()},{deep:!0}),(s,t)=>(i(),u("div",Y,[e("div",Z,[e("div",ee,[e("div",te,y(x.otherUserId),1),e("div",null,[e("h2",se," Chat with User "+y(x.otherUserId),1),e("div",re,[e("span",{class:w(["w-2 h-2 rounded-full mr-2",k.value?"bg-green-400":"bg-gray-400"])},null,2),e("span",ae,y(k.value?"Online":"Offline"),1)])])]),e("button",{class:"text-white hover:text-gray-200",onClick:j},t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]))]),e("div",{ref_key:"messagesContainer",ref:g,class:"messages-area flex-1 p-4 overflow-y-auto bg-gray-50 dark:bg-gray-800 transition-colors duration-300"},[(i(!0),u(T,null,N(n.value,(c,U)=>(i(),u("div",{key:U,class:w(["message mb-4 flex",c.sender_id==l.value?"justify-end":"justify-start"])},[e("div",{class:w(["message-bubble max-w-xs lg:max-w-md px-4 py-2 rounded-lg",c.sender_id==l.value?"bg-indigo-500 text-white rounded-br-none":"bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none shadow-sm"])},[e("p",oe,y(c.message),1),e("div",ne,[e("span",de,y(L(c.time)),1),c.sender_id==l.value&&c.read?(i(),u("span",{key:0,class:w(["text-xs",c.read?"text-green-400":"text-gray-400"])}," ✓✓ ",2)):D("",!0)])],2)],2))),128))],512),e("div",ie,[e("div",le,[e("button",{onClick:a,class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 mr-2 text-gray-500 dark:text-gray-400"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])),V(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>v.value=c),onKeyup:Q(I,["enter"]),placeholder:"Type your message...",class:"flex-1 py-2 px-4 rounded-full bg-gray-100 dark:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 border-none"},null,544),[[O,v.value]]),e("button",{onClick:I,disabled:!v.value.trim(),class:w(["ml-2 p-2 rounded-full text-white",v.value.trim()?"bg-indigo-500 hover:bg-indigo-600":"bg-gray-400 cursor-not-allowed"])},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)]),10,ce)])])]))}},ge=R(ue,[["__scopeId","data-v-b732bab1"]]),he={class:"chat-layout flex h-screen bg-gray-50 dark:bg-gray-900"},ve={class:"users-sidebar w-full sm:w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-y-auto"},me={class:"p-4 border-b border-gray-200 dark:border-gray-700"},fe={class:"relative mt-3"},ye={key:0,class:"divide-y divide-gray-200 dark:divide-gray-700 my-2"},xe=["onClick"],be={class:"relative"},pe={class:"w-10 h-10 rounded-full bg-indigo-100 dark:bg-gray-600 flex items-center justify-center text-indigo-600 dark:text-indigo-300 font-semibold"},_e={key:0,class:"absolute bottom-0 right-0 w-3 h-3 rounded-full bg-green-500 border-2 border-white dark:border-gray-800"},we={class:"ml-3 flex-1 overflow-hidden"},ke={class:"flex justify-between items-center"},Ie={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},Ce={class:"text-xs text-gray-500 dark:text-gray-400"},Ue={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},Me={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},$e={class:"chat-content flex-1 flex flex-col"},Se={key:0,class:"flex-1 overflow-hidden"},je={key:1,class:"flex-1 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400"},Le={__name:"ChatView",setup(x){const h=A(),r=f([]),b=f(null),S=q();let g=f(""),l=f(!1);const n=o=>{b.value=o,h.otherUserId=o.sender_id,l.value=!0},v=()=>{b.value={},l.value=!1},k=async()=>{var o;try{r.value=await W(),console.log(r.value),((o=r.value)==null?void 0:o.error_code)!=401?(r.value=r.value.map(a=>({...a,online:Math.random()>.3,last_message:a.last_message||"No messages yet",last_message_time:a.last_message_time||new Date})),l.value=!l.value):S.push("/login")}catch(a){console.error("Error fetching users:",a)}},j=()=>{if(g.value.length!=0){const o=r.value.filter(a=>{var p,m;return(m=(p=a.sender)==null?void 0:p.name)==null?void 0:m.toLowerCase().includes(g.value.toLowerCase())});r.value=o}else console.log("Qidiruv bo‘sh"),k()},I=o=>o?new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",L=(o,a)=>{console.log(o,a)};return z(()=>{k()}),$(()=>h.messageCount,o=>{L(h.chatMessage,o)}),(o,a)=>{var p,m;return i(),u("div",he,[e("div",ve,[e("div",me,[a[2]||(a[2]=e("h2",{class:"text-xl font-semibold text-gray-800 dark:text-white"}," Chatlar ",-1)),e("div",fe,[V(e("input",{type:"text",placeholder:"Qidirish...","onUpdate:modelValue":a[0]||(a[0]=d=>X(g)?g.value=d:g=d),onInput:j,class:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"},null,544),[[O,M(g)]]),a[1]||(a[1]=e("svg",{class:"absolute right-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),r.value.length>0?(i(),u("div",ye,[(i(!0),u(T,null,N(r.value,d=>{var C,s,t,c,U;return i(),u("div",{key:d.id,onClick:Be=>n(d),class:w(["user-item px-4 py-3 flex items-center hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors duration-200",{"bg-indigo-50 dark:bg-gray-700 border-r-4 border-indigo-500":((C=b.value)==null?void 0:C.id)===d.id}])},[e("div",be,[e("div",pe,y(((c=(t=(s=d.sender)==null?void 0:s.name)==null?void 0:t.charAt(0))==null?void 0:c.toUpperCase())||"U"),1),d.online?(i(),u("span",_e)):D("",!0)]),e("div",we,[e("div",ke,[e("h3",Ie,y(((U=d.sender)==null?void 0:U.name)||"Nomaʼlum"),1),e("span",Ce,y(I(d.last_message_time)),1)]),e("p",Ue,y(d.last_message||"No messages yet"),1)])],10,xe)}),128))])):(i(),u("div",Me,a[3]||(a[3]=[e("p",null,"Hozircha xabarlar yo'q",-1)])))]),e("div",$e,[M(l)?(i(),u("div",Se,[(i(),G(ge,{otherUserId:((p=b.value)==null?void 0:p.sender_id)||M(h).otherUserId,key:((m=b.value)==null?void 0:m.sender_id)||M(h).otherUserId,onChatClose:v},null,8,["otherUserId"]))])):(i(),u("div",je,a[4]||(a[4]=[J('<div class="w-24 h-24 mb-4 text-indigo-200 dark:text-gray-600" data-v-d18af7df><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-d18af7df><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-d18af7df></path></svg></div><h3 class="text-xl font-medium mb-2" data-v-d18af7df>Chatni boshlang</h3><p class="text-center max-w-md px-4" data-v-d18af7df> Chapdagi ro&#39;yxatdan foydalanuvchini tanlang <br data-v-d18af7df>yoki yangi suhbat boshlang </p>',3)])))])])}}},Ae=R(Le,[["__scopeId","data-v-d18af7df"]]);export{Ae as default};
