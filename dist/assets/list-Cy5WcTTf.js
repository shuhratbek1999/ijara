import{_ as z,r as o,y as R,h as Y,p as n,o as b,a as A,b as w,j as s,q as i,k as G,F as S,d as H,s as y,E as J,P as Q,D as W,g as r,m as c,l as X,e as Z,t as aa}from"./index-FDdxv7ms.js";import{M as ea}from"./modal-BwOYB0B4.js";import{P as ta}from"./PlusCircleOutlined-fi28KdLX.js";const la={class:"list overflow-x-auto"},sa={class:"fields w-full mt-4"},oa={__name:"list",setup(na){const k=o([]),d=o([]),C=o([]),m=o(!1),f=o(null),u=o(!1),e=R({name:"",sub_cat_id:null,fields:[]}),D=o({title:"Kategoriyani boshqarish",width:"90%"}),x=[{title:"Nomi",dataIndex:"name",key:"name"},{title:"Amallar",key:"action",customRender:({record:a})=>y("div",{class:"flex gap-4"},[y(J,{class:"text-blue-500 cursor-pointer",onClick:()=>B(a.id)}),y(Q,{title:"Rostan ham o'chirmoqchimisiz?",onConfirm:()=>N(a.id)},{default:()=>y(W,{class:"text-red-500 cursor-pointer"})})])}],E=async()=>{try{u.value=!0,await Promise.all([g(),I(),K()])}catch{r.error("Ma'lumotlarni yuklashda xatolik")}finally{u.value=!1}},g=async()=>{const a=await c.get("category/all");k.value=a.data.data},I=async()=>{const a=await c.get("subcategory/all");d.value=a.data.data,d.value.length>0&&!e.sub_cat_id&&(e.sub_cat_id=d.value[0].id)},K=async()=>{const a=await c.get("fields/all");C.value=a.data.data},O=async a=>{try{u.value=!0;const t=await c.get(`category/one/${a}`),{fields:p,..._}=t.data.data;e.name=_.name,e.sub_cat_id=_.sub_cat_id,p[0]!==null&&(e.fields=p.map(h=>h.id)),f.value=a,m.value=!0}catch(t){r.error("Kategoriyani yuklashda xatolik"+t)}finally{u.value=!1}},P=()=>{v(),m.value=!0},B=a=>{O(a)},N=async a=>{try{await c.delete(`category/delete/${a}`),r.success("Kategoriya o'chirildi"),await g()}catch{r.error("O'chirishda xatolik")}},L=()=>{m.value=!1,v()},q=async()=>{try{u.value=!0;const a={name:e.name,sub_cat_id:e.sub_cat_id,fields:e.fields.map(t=>({cat_id:t}))};f.value?(await c.patch(`category/update/${f.value}`,a),r.success("Kategoriya muvaffaqiyatli yangilandi")):(await c.post("category/create",a),r.success("Yangi kategoriya muvaffaqiyatli qo'shildi")),m.value=!1,v(),await g()}catch{r.error("Amalni bajarishda xatolik")}finally{u.value=!1}},T=a=>{e.sub_cat_id=a},U=a=>{e.fields=a},V=(a,t)=>t.label.toLowerCase().includes(a.toLowerCase()),v=()=>{var a;e.name="",e.sub_cat_id=((a=d.value[0])==null?void 0:a.id)||null,e.fields=[],f.value=null};return Y(()=>{E()}),(a,t)=>{const p=n("a-table"),_=n("a-float-button"),h=n("a-select-option"),M=n("a-select"),F=n("a-form-item"),$=n("a-input"),j=n("a-form");return b(),A(S,null,[w("div",la,[s(p,{columns:x,"data-source":k.value,pagination:{pageSize:50},scroll:{x:x.length*150,y:400}},null,8,["data-source","scroll"]),s(_,{type:"primary",onClick:P},{icon:i(()=>[s(G(ta))]),_:1})]),s(ea,{open:m.value,styles:D.value,onClose:L,onAdd:q},{category:i(()=>[s(j,{model:e,name:"category-form",autocomplete:"off",class:"w-full",onFinish:q},{default:i(()=>[s(F,{name:"sub_cat_id",label:"Turkum",rules:[{required:!0,message:"Iltimos, turkumni tanlang!"}],"label-col":{span:24},"wrapper-col":{span:24},class:"w-8/12"},{default:i(()=>[s(M,{value:e.sub_cat_id,"onUpdate:value":t[0]||(t[0]=l=>e.sub_cat_id=l),placeholder:"Turkumni tanlang",onChange:T},{default:i(()=>[(b(!0),A(S,null,H(d.value,l=>(b(),X(h,{key:l.id,value:l.id},{default:i(()=>[Z(aa(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(F,{name:"name",label:"Kategoriya nomi",rules:[{required:!0,message:"Iltimos, nom kiriting!"}],"label-col":{span:24},"wrapper-col":{span:24},class:"w-8/12"},{default:i(()=>[s($,{value:e.name,"onUpdate:value":t[1]||(t[1]=l=>e.name=l),placeholder:"Masalan, Elektronika"},null,8,["value"])]),_:1}),w("div",sa,[t[3]||(t[3]=w("h2",{class:"text-lg font-semibold mb-2"},"Maydonlar",-1)),s(M,{value:e.fields,"onUpdate:value":t[2]||(t[2]=l=>e.fields=l),"show-search":"","filter-option":V,mode:"multiple",style:{width:"100%"},placeholder:"Maydonlarni tanlang",onChange:U,options:C.value.map(l=>({value:l.id,label:l.field_name}))},null,8,["value","options"])])]),_:1},8,["model"])]),_:1},8,["open","styles"])],64)}}},ua=z(oa,[["__scopeId","data-v-f2c07ced"]]);export{ua as default};
