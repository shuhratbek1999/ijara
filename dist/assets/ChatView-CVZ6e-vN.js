import{m as S,_ as j,H as L,v as O,r as f,h as B,S as p,A as M,o as l,a as g,b as e,t as x,n as b,F as A,d as R,f as z,K as T,L as N,O as E,C as H,k as C,z as K,l as Q,Q as F}from"./index-FDdxv7ms.js";const D="http://176.53.163.29:7005/api/v1/admin-app",V=localStorage.getItem("token");async function q({myId:m,otherUserId:r}){return(await S.get(`${D}/message/one/${m}/${r}`,{headers:{Authorization:`Bearer ${V}`}})).data.data}async function X(){const m=localStorage.getItem("userID");return(await S.get(`${D}/message/incoming/${m}`,{headers:{Authorization:`Bearer ${V}`}})).data}const G={class:"chat-container"},J={class:"chat-header bg-indigo-600 text-white p-4 flex justify-between items-center shadow-md"},P={class:"flex items-center"},W={class:"w-10 h-10 rounded-full bg-indigo-400 flex items-center justify-center text-white font-bold mr-3"},Y={class:"font-semibold text-lg"},Z={class:"flex items-center"},ee={class:"text-sm"},te={class:"message-text"},se={class:"message-meta flex justify-end items-center mt-1"},re={class:"text-xs opacity-70 mr-1"},ae={class:"message-input bg-white dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 p-3"},oe={class:"flex items-center"},ne=["disabled"],de={__name:"ChatContent",props:{otherUserId:[String,Number]},setup(m){const r=m,u=L();O();const h=f(null),i=f(localStorage.getItem("userID")),n=f([]),v=f(""),_=f(!1),k=async()=>{if(v.value.trim())try{await p.sendMessage({receiverId:r.otherUserId,message:v.value,read:!1}),v.value="",a()}catch(s){console.error("Error sending message:",s)}},$=s=>new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a=()=>{H(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})},o=()=>{},w=()=>{p.onMessagesRead(({receiverId:s})=>{n.value=n.value.map(t=>t.receiverId==s?{...t,read:!0}:t)})},y=()=>{Array.isArray(n.value)&&n.value.filter(t=>t.sender_id==r.otherUserId&&!t.read).length>0&&(p.markAsRead({receiverId:i.value,senderId:r.otherUserId}),n.value=n.value.map(t=>t.sender_id==r.otherUserId&&!t.read?{...t,read:!0}:t))},d=async()=>{try{n.value=await q({myId:i.value,otherUserId:r.otherUserId}),y()}catch(s){console.error("Xatolik xabarlarni olishda:",s)}},I=async()=>{await p.onReceiveMessage(s=>{n.value.push({receiverId:s.receiverId,sender_id:s.sender_id,message:s.message,time:s.time,read:s.read}),s.sender_id==r.otherUserId&&!s.read&&(p.markAsRead({senderId:s.sender_id,receiverId:s.receiverId}),n.value=n.value.map(t=>t.sender_id==r.otherUserId&&!t.read?{...t,read:!0}:t))})};return B(async()=>{r.otherUserId&&await p.joinRoom({myId:i.value,otherUserId:r.otherUserId}),await I(),await w(),await y(),await d()}),M(()=>u.chatMessage,s=>{Object.keys(s).length!=0&&n.value.length==0&&n.value.push(s)},{immediate:!0}),M(()=>r.otherUserId,()=>{d()}),M(n,()=>{y()},{deep:!0}),(s,t)=>(l(),g("div",G,[e("div",J,[e("div",P,[e("div",W,x(m.otherUserId?"":m.otherUserId.charAt(0).toUpperCase()),1),e("div",null,[e("h2",Y," Chat with User "+x(m.otherUserId),1),e("div",Z,[e("span",{class:b(["w-2 h-2 rounded-full mr-2",_.value?"bg-green-400":"bg-gray-400"])},null,2),e("span",ee,x(_.value?"Online":"Offline"),1)])])]),t[1]||(t[1]=e("button",{class:"text-white hover:text-gray-200"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),e("div",{ref_key:"messagesContainer",ref:h,class:"messages-area flex-1 p-4 overflow-y-auto bg-gray-50 dark:bg-gray-800 transition-colors duration-300"},[(l(!0),g(A,null,R(n.value,(c,U)=>(l(),g("div",{key:U,class:b(["message mb-4 flex",c.sender_id==i.value?"justify-end":"justify-start"])},[e("div",{class:b(["message-bubble max-w-xs lg:max-w-md px-4 py-2 rounded-lg",c.sender_id==i.value?"bg-indigo-500 text-white rounded-br-none":"bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-bl-none shadow-sm"])},[e("p",te,x(c.message),1),e("div",se,[e("span",re,x($(c.time)),1),c.sender_id==i.value&&c.read?(l(),g("span",{key:0,class:b(["text-xs",c.read?"text-green-400":"text-gray-400"])}," ✓✓ ",2)):z("",!0)])],2)],2))),128))],512),e("div",ae,[e("div",oe,[e("button",{onClick:o,class:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-600 mr-2 text-gray-500 dark:text-gray-400"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})],-1)])),T(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>v.value=c),onKeyup:E(k,["enter"]),placeholder:"Type your message...",class:"flex-1 py-2 px-4 rounded-full bg-gray-100 dark:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 border-none"},null,544),[[N,v.value]]),e("button",{onClick:k,disabled:!v.value.trim(),class:b(["ml-2 p-2 rounded-full text-white",v.value.trim()?"bg-indigo-500 hover:bg-indigo-600":"bg-gray-400 cursor-not-allowed"])},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)]),10,ne)])])]))}},ie=j(de,[["__scopeId","data-v-4552cde4"]]),le={class:"chat-layout flex h-screen bg-gray-50 dark:bg-gray-900"},ce={class:"users-sidebar w-full sm:w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 overflow-y-auto"},ge={class:"p-4 border-b border-gray-200 dark:border-gray-700"},ue={class:"relative mt-3"},he={key:0,class:"divide-y divide-gray-200 dark:divide-gray-700"},ve=["onClick"],me={class:"relative"},ye={class:"w-10 h-10 rounded-full bg-indigo-100 dark:bg-gray-600 flex items-center justify-center text-indigo-600 dark:text-indigo-300 font-semibold"},fe={key:0,class:"absolute bottom-0 right-0 w-3 h-3 rounded-full bg-green-500 border-2 border-white dark:border-gray-800"},xe={class:"ml-3 flex-1 overflow-hidden"},we={class:"flex justify-between items-center"},pe={class:"text-sm font-medium text-gray-900 dark:text-white truncate"},be={class:"text-xs text-gray-500 dark:text-gray-400"},_e={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},ke={key:1,class:"p-4 text-center text-gray-500 dark:text-gray-400"},Ie={class:"chat-content flex-1 flex flex-col"},Ue={key:0,class:"flex-1 overflow-hidden"},Ce={key:1,class:"flex-1 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400"},Me={__name:"ChatView",setup(m){const r=L(),u=f([]),h=f(null);let i=f("");f(0);const n=a=>{h.value=a,r.otherUserId=a.sender_id},v=async()=>{try{u.value=await X(),u.value=u.value.map(a=>({...a,online:Math.random()>.3,last_message:a.last_message||"No messages yet",last_message_time:a.last_message_time||new Date})),console.log(u.value)}catch(a){console.error("Error fetching users:",a)}},_=()=>{if(i.value.length!=0){const a=u.value.filter(o=>{var w,y;return(y=(w=o.sender)==null?void 0:w.name)==null?void 0:y.toLowerCase().includes(i.value.toLowerCase())});u.value=a}else console.log("Qidiruv bo‘sh"),v()},k=a=>a?new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",$=(a,o)=>{console.log(a,o)};return B(()=>{v()}),M(()=>r.messageCount,a=>{$(r.chatMessage,a)}),(a,o)=>{var w,y;return l(),g("div",le,[e("div",ce,[e("div",ge,[o[2]||(o[2]=e("h2",{class:"text-xl font-semibold text-gray-800 dark:text-white"}," Chatlar ",-1)),e("div",ue,[T(e("input",{type:"text",placeholder:"Qidirish...","onUpdate:modelValue":o[0]||(o[0]=d=>K(i)?i.value=d:i=d),onInput:_,class:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-gray-800 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"},null,544),[[N,C(i)]]),o[1]||(o[1]=e("svg",{class:"absolute right-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),u.value.length>0?(l(),g("div",he,[(l(!0),g(A,null,R(u.value,d=>{var I,s,t,c,U;return l(),g("div",{key:d.id,onClick:$e=>n(d),class:b(["user-item px-4 py-3 flex items-center hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors duration-200",{"bg-indigo-50 dark:bg-gray-700 border-r-4 border-indigo-500":((I=h.value)==null?void 0:I.id)===d.id}])},[e("div",me,[e("div",ye,x(((c=(t=(s=d.sender)==null?void 0:s.name)==null?void 0:t.charAt(0))==null?void 0:c.toUpperCase())||"U"),1),d.online?(l(),g("span",fe)):z("",!0)]),e("div",xe,[e("div",we,[e("h3",pe,x(((U=d.sender)==null?void 0:U.name)||"Nomaʼlum"),1),e("span",be,x(k(d.last_message_time)),1)]),e("p",_e,x(d.last_message||"No messages yet"),1)])],10,ve)}),128))])):(l(),g("div",ke,o[3]||(o[3]=[e("p",null,"Hozircha xabarlar yo'q",-1)])))]),e("div",Ie,[h.value||C(r).otherUserId?(l(),g("div",Ue,[(l(),Q(ie,{otherUserId:((w=h.value)==null?void 0:w.sender_id)||C(r).otherUserId,key:((y=h.value)==null?void 0:y.sender_id)||C(r).otherUserId},null,8,["otherUserId"]))])):(l(),g("div",Ce,o[4]||(o[4]=[F('<div class="w-24 h-24 mb-4 text-indigo-200 dark:text-gray-600" data-v-d6d0af35><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-d6d0af35><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-d6d0af35></path></svg></div><h3 class="text-xl font-medium mb-2" data-v-d6d0af35>Chatni boshlang</h3><p class="text-center max-w-md px-4" data-v-d6d0af35> Chapdagi ro&#39;yxatdan foydalanuvchini tanlang <br data-v-d6d0af35>yoki yangi suhbat boshlang </p>',3)])))])])}}},je=j(Me,[["__scopeId","data-v-d6d0af35"]]);export{je as default};
