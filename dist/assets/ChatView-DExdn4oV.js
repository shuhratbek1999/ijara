import{f as b,a as n,c as i,n as a,_ as $,C as M,m as N,r as v,o as S,S as p,x as y,F as R,q as A,A as B,t as k,e as O,b as x,H as T,J as H,K,z as L,u as C,d as X}from"./index-B_p4t0Lo.js";const z="http://176.53.163.29:7005/api/v1/admin-app",V=localStorage.getItem("token");async function q({myId:l,otherUserId:t}){return(await b.get(`${z}/message/one/${l}/${t}`,{headers:{Authorization:`Bearer ${V}`}})).data.data}async function E(){const l=localStorage.getItem("userID");return console.log("salommm",l),(await b.get(`${z}/message/incoming/${l}`,{headers:{Authorization:`Bearer ${V}`}})).data}const J={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},G={__name:"SendIcon",setup(l){return(t,o)=>(n(),i("svg",J,o[0]||(o[0]=[a("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),a("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])))}},P={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Q={__name:"FileIcon",setup(l){return(t,o)=>(n(),i("svg",P,o[0]||(o[0]=[a("path",{d:"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"},null,-1),a("polyline",{points:"13 2 13 9 20 9"},null,-1)])))}},W=$(Q,[["__scopeId","data-v-e641e9aa"]]),Y={class:"chat-room w-full"},Z={class:"chat-header"},ee={key:0,class:"online-status online"},se={key:1,class:"online-status offline"},te={class:"message-content flex"},re={key:0,title:"O‘qilgan",style:{color:"green"},class:"text-xs mt-6"},ae={class:"mt-6 inline-block text-xs"},ne={class:"message-input grid gap-2"},oe=["disabled"],ie={__name:"ChatContent",props:{otherUserId:[String,Number]},setup(l){const t=l,o=M();N();const d=v(null),c=v(localStorage.getItem("userID")),r=v([]),u=v(""),m=v(!1),h=async()=>{if(u.value.trim())try{await p.sendMessage({receiverId:t.otherUserId,message:u.value,read:!1}),u.value="",g()}catch(e){console.error("Xabar yuborishda xato:",e)}},I=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),g=()=>{L(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})},w=()=>{},j=()=>{p.onMessagesRead(({receiverId:e})=>{r.value=r.value.map(s=>s.receiverId==e?(o.messageCount-=1,{...s,read:!0}):s)})},f=()=>{Array.isArray(r.value)&&r.value.filter(s=>s.sender_id==t.otherUserId&&!s.read).length>0&&(p.markAsRead({receiverId:c.value,senderId:t.otherUserId}),r.value=r.value.map(s=>s.sender_id==t.otherUserId&&!s.read?{...s,read:!0}:s))},U=async()=>{try{r.value=await q({myId:c.value,otherUserId:t.otherUserId}),f(),g()}catch(e){console.error("Xatolik xabarlarni olishda:",e)}},D=async()=>{await p.onReceiveMessage(e=>{r.value.push({receiverId:e.receiverId,sender_id:e.sender_id,message:e.message,time:e.time,read:e.read}),e.sender_id==t.otherUserId&&!e.read&&(p.markAsRead({senderId:e.sender_id,receiverId:e.receiverId}),r.value=r.value.map(s=>s.sender_id==t.otherUserId&&!s.read?{...s,read:!0}:s),g())})};return S(async()=>{t.otherUserId&&await p.joinRoom({myId:c.value,otherUserId:t.otherUserId}),await D(),await j(),await f(),await U()}),y(()=>o.chatMessage,e=>{Object.keys(e).length!=0&&r.value.length==0&&r.value.push(e)},{immediate:!0}),y(()=>t.otherUserId,()=>{U()}),y(r,()=>{f()},{deep:!0}),(e,s)=>(n(),i("div",Y,[a("div",Z,[s[1]||(s[1]=a("h2",null,"Chat Room",-1)),m.value?(n(),i("span",ee,"Online")):(n(),i("span",se,"Offline"))]),a("div",{class:"messages overflow-y-scroll h-[600px] bg-gray-300 p-4",ref_key:"messagesContainer",ref:d},[(n(!0),i(R,null,A(r.value,(_,F)=>(n(),i("div",{key:F,class:B(["message",_.sender_id==c.value?"sent":"received"])},[a("div",te,[a("p",null,k(_.message),1),_.sender_id==c.value&&_.read?(n(),i("span",re," ✔️✔️ ")):O("",!0),a("span",ae,k(I(_.time)),1)])],2))),128))],512),a("div",ne,[a("button",{onClick:w},[x(W)]),T(a("input",{"onUpdate:modelValue":s[0]||(s[0]=_=>u.value=_),onKeyup:K(h,["enter"]),placeholder:"Xabar yozing..."},null,544),[[H,u.value]]),a("button",{onClick:h,disabled:!u.value.trim()},[x(G)],8,oe)])]))}},le=$(ie,[["__scopeId","data-v-5430bccd"]]),de={class:"grid grid-cols-3 h-screen"},ce={class:"border-r p-4 overflow-y-auto"},ue=["onClick"],he={class:"col-span-2"},_e={key:1,class:"flex items-center justify-center h-full text-gray-500"},ge={__name:"ChatView",setup(l){const t=M(),o=v([]),d=v(null),c=r=>{d.value=r,t.otherUserId=r.sender_id};return S(async()=>{o.value=await E()}),(r,u)=>{var m;return n(),i("div",de,[a("div",ce,[(n(!0),i(R,null,A(o.value,h=>{var I,g;return n(),i("div",{key:h.id,onClick:w=>c(h),class:B(["p-2 hover:bg-gray-100 cursor-pointer rounded",{"bg-blue-100":((I=d.value)==null?void 0:I.id)===h.id}])},k((g=h.sender)==null?void 0:g.name),11,ue)}),128))]),a("div",he,[d.value||C(t).otherUserId?(n(),X(le,{key:0,otherUserId:((m=d.value)==null?void 0:m.sender_id)||C(t).otherUserId},null,8,["otherUserId"])):(n(),i("div",_e," Foydalanuvchini tanlang "))])])}}};export{ge as default};
